<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Signature Collection</title>
    <meta property="og:title" content="You have a digital envelope... üíå">
    <meta property="og:description" content="Someone special has sent you a Signature Bouquet. Tap to open.">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Alex+Brush&family=Great+Vibes&family=Dancing+Script&family=Parisienne&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="theme-ivory">

    <div id="landscape-lock">
        <h2>Please Rotate Your Phone üì±</h2>
        <p>This experience is designed to be viewed upright.</p>
    </div>

    <div id="magic-container"></div>

    <div class="app-container">
        
        <div id="loading-screen" class="hidden gallery-card envelope-container">
            <div class="spinner"></div>
            <p style="margin-top: 15px; font-style: italic; color: #7A7A7A;">Preparing your delivery...</p>
        </div>

        <div id="envelope-screen" class="hidden gallery-card envelope-container">
            <div class="envelope-content">
                <p class="envelope-label">A digital delivery for</p>
                <h1 id="envelope-name" style="font-family: 'Great Vibes', cursive; font-size: 3.5rem; margin: 10px 0;">Someone Special</h1>
                <button class="btn-seal" onclick="openEnvelope()">Break the Seal üïØÔ∏è</button>
            </div>
        </div>

        <div id="view-mode" class="hidden gallery-card view-container">
            <canvas id="scratch-card"></canvas>
            <div id="revealed-content" class="locked-content">
                
                <div class="bouquet-presentation">
                    <img id="shared-bouquet-img" src="" alt="Your Bouquet">
                    
                    <div id="vintage-stamp" class="vintage-stamp hidden">
                        <span class="stamp-text">EST.<br><span id="stamp-date-text"></span></span>
                    </div>

                    <div id="text-overlay-box" class="text-overlay">
                        <p id="shared-message" class="message-text"></p>
                        <p id="shared-signature" class="signature-text"></p>
                    </div>
                </div>

                <iframe id="shared-spotify" src="" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media" class="hidden spotify-player"></iframe>

                <button class="btn-primary" id="reply-btn" onclick="window.location.href=window.location.pathname">Create Your Own</button>
                <button class="btn-secondary hidden" id="close-preview-btn" onclick="closePreview()">Close Preview</button>
            </div>
            <button id="skip-scratch-btn" class="hidden btn-secondary skip-btn" onclick="forceReveal()">Skip Reveal ü™Ñ</button>
        </div>

        <div id="edit-mode">
            <div id="step-1" class="step-container">
                <h1>1. The Collection</h1>
                <p class="subtitle">Select your masterpiece.</p>
                <div class="gallery-card">
                    <div class="carousel">
                        <button class="btn-nav" onclick="prevBouquet()">‚ùÆ</button>
                        <img id="current-bouquet-img" src="assets/1.jpg" alt="Bouquet Selection">
                        <button class="btn-nav" onclick="nextBouquet()">‚ùØ</button>
                    </div>
                    <p class="bouquet-label">Bouquet <span id="bouquet-counter">1</span> / 25</p>
                </div>
                <button class="btn-primary" onclick="goToStep(2)">Next: Design Your Note üñãÔ∏è</button>
            </div>

            <div id="step-2" class="step-container hidden">
                <h1>2. The Details</h1>
                <p class="subtitle">Customize the presentation.</p>
                <div class="message-box">
                    <input type="text" id="recipient-name" class="signature-input" placeholder="Recipient's Name (e.g., Sarah)" oninput="saveDraft()">
                    
                    <div class="textarea-wrapper">
                        <textarea id="custom-message" placeholder="Write something beautiful..." maxlength="300" oninput="saveDraft()"></textarea>
                        <span class="char-counter" id="char-count">0/300</span>
                    </div>

                    <input type="text" id="sender-name" class="signature-input" placeholder="Sign your name (e.g., - Love, Alex)" oninput="saveDraft()">
                    
                    <input type="url" id="spotify-link" class="signature-input" placeholder="Spotify Song Link üéµ (Optional)" style="text-align: left;" oninput="saveDraft()">
                    
                    <p class="section-label">Memory Date (For the vintage stamp):</p>
                    <input type="date" id="memory-date" class="signature-input" oninput="saveDraft()">
                    
                    <p class="section-label">Typography:</p>
                    <div class="font-picker">
                        <button class="font-btn active" style="font-family: 'Alex Brush', cursive;" onclick="changeFont(this, 'Alex Brush')">Aa</button>
                        <button class="font-btn" style="font-family: 'Great Vibes', cursive;" onclick="changeFont(this, 'Great Vibes')">Aa</button>
                        <button class="font-btn" style="font-family: 'Parisienne', cursive;" onclick="changeFont(this, 'Parisienne')">Aa</button>
                        <button class="font-btn" style="font-family: 'Dancing Script', cursive;" onclick="changeFont(this, 'Dancing Script')">Aa</button>
                        <button class="font-btn" style="font-family: 'Playfair Display', serif; font-style: italic;" onclick="changeFont(this, 'Playfair Display')">Aa</button>
                    </div>

                    <p class="section-label">Cardstock Theme:</p>
                    <div class="color-picker">
                        <button class="color-btn active" style="background: #FDFCF8;" onclick="changeTheme(this, 'ivory')"></button>
                        <button class="color-btn" style="background: #FFF0F3;" onclick="changeTheme(this, 'blush')"></button>
                        <button class="color-btn" style="background: #F0F4F1;" onclick="changeTheme(this, 'sage')"></button>
                        <button class="color-btn" style="background: #F4F0F8;" onclick="changeTheme(this, 'lavender')"></button>
                        <button class="color-btn" style="background: #1A1C20; border: 1px solid #555;" onclick="changeTheme(this, 'midnight')"></button>
                    </div>
                </div>
                <div class="button-row">
                    <button class="btn-secondary" onclick="goToStep(1)">Back</button>
                    <button class="btn-primary" onclick="validateAndProceed()">Next: Finalize üíå</button>
                </div>
            </div>

            <div id="step-3" class="step-container hidden">
                <h1>3. Ready to Send</h1>
                <p class="subtitle">Your digital envelope is sealed.</p>
                <button class="btn-secondary" style="margin-bottom: 15px;" onclick="previewCard()">üëÄ Test The Experience</button>
                <button class="btn-primary" id="generate-btn" onclick="generateLink()">Generate Unique Link üîó</button>
                <div id="share-link-container" class="hidden share-box">
                    <input type="text" id="share-link" readonly>
                    <button class="btn-secondary copy-btn" onclick="copyLink()">Copy Link</button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #7A7A7A;">Text this short link safely!</p>
                </div>
                <button class="btn-secondary" style="margin-top: 20px; border: none;" onclick="goToStep(2)">Wait, edit note</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database-compat.js"></script>
    
    <script src="script.js"></script>
</body>
</html>
